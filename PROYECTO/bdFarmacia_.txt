/*
	--------CAMBIOS-------
	11/11/2018
		*Se corrigio errores en los procedimientos de insertarpersona,medicamento y guia de remision.
		*Se agrego el campo correo a la tabla Persona
		*Se se agrego "up_" a los nombre de los procemientos y otras cosas mas.....




*/



DROP DATABASE IF EXISTS farmacia;
CREATE DATABASE IF NOT EXISTS farmacia;
USE farmacia;
________________________________________________________________
-- CREACIÓN DE TABLAS
CREATE TABLE Empresa(
	RUC 		VARCHAR(12) 	PRIMARY KEY,
	RazónSocial 	VARCHAR(40) 	NOT NULL,
	Telefono 	VARCHAR(10),
	Dirección 	VARCHAR(20),
	TipoEmpresa	VARCHAR(30)
) ;
CREATE TABLE Laboratorio(
	RUC		VARCHAR(12) 	,
	IdLaboratorio	INT  PRIMARY KEY AUTO_INCREMENT,
	RegSanitario	VARCHAR(20) ,
	FOREIGN KEY (RUC)REFERENCES Empresa(RUC)
);
CREATE TABLE Transporte(
	RUC 		VARCHAR(12) 	,
	IdTransporte 	INT 		PRIMARY KEY AUTO_INCREMENT,
	Placa 		VARCHAR(20)	NOT NULL,
	FOREIGN KEY (RUC)REFERENCES Empresa(RUC)
);
CREATE TABLE Persona(
	DNI		CHAR(8) NOT NULL PRIMARY KEY,
	Nombre 		VARCHAR(25) 	NOT NULL,
	Apellido 	VARCHAR(20)	NOT NULL,
	Correo		VARCHAR(20)	NOT NULL,
	FecNac 		DATE 		NOT NULL,
	Genero 		ENUM ('M','F')  NOT NULL,
	Direccion	VARCHAR(20)	NOT NULL,
	TipoPersona	ENUM ('Empleado','Transportista') NOT NULL
);
CREATE TABLE Empleado(
	IdEmpleado 	INT AUTO_INCREMENT PRIMARY KEY,
	Turno		VARCHAR(20)	NOT NULL,
	Especialidad	VARCHAR(20)	NOT NULL,
	Usuario		VARCHAR(20)	UNIQUE	NOT NULL,
	Clave		VARCHAR(20)	NOT NULL,
	DNI		VARCHAR(8)		,
	FOREIGN KEY (DNI)REFERENCES Persona(DNI)
);
CREATE TABLE Transportista(
	DNI 		VARCHAR(8)	,
	IdTransporte	INT,
	NroLicencia	VARCHAR(15)	NOT NULL,
	FOREIGN KEY (DNI)REFERENCES Persona(DNI),
	FOREIGN KEY (IdTransporte) REFERENCES Transporte(IdTransporte)
);
CREATE TABLE GuiaRemision(
	NroGuia 	VARCHAR(20) 	PRIMARY KEY,
	PuntoPartida 	VARCHAR(20) 	NOT NULL,
	PuntoLLegada	VARCHAR(20) 	NOT NULL,
	FecEmision 	DATE		NOT NULL,
	FecInicTraslado DATE 		NOT NULL,
	MotTraslado	VARCHAR(20)	NOT NULL,
	IdTransporte	INT ,
	FOREIGN KEY (IdTransporte) REFERENCES Transporte(IdTransporte)

);
CREATE TABLE UnidadMedida(
	Id 		INT		PRIMARY KEY AUTO_INCREMENT,
	Descripcion 	VARCHAR(10)	NOT NULL
);
CREATE TABLE TipoPresentacion(
	Id		INT 		PRIMARY KEY AUTO_INCREMENT,
	Nombre		VARCHAR(20)	NOT NULL,
	Descripcion	VARCHAR(30)	NOT NULL
);
CREATE TABLE Medicamento(
	CodMed		VARCHAR(20)	PRIMARY KEY,
	Nombre		VARCHAR(20)	NOT NULL,
	NomLaboratorio	VARCHAR(20) 	NOT NULL,
	IdLaboratorio	INT,
	FOREIGN KEY (IdLaboratorio)REFERENCES Laboratorio(IdLaboratorio)
);
CREATE TABLE dtMED(
	CodMed		VARCHAR(20) 	,
	CodPre		INT		,
	CodDtMed	INT		PRIMARY KEY	AUTO_INCREMENT,
	Psicotrópico	ENUM ('Si','No') NOT NULL,
	PesoUnitario	DECIMAL(6,2)	NOT NULL,
	FecVenc		DATE 		NOT NULL,
	Descripcion	VARCHAR(20)	NOT NULL,
	FOREIGN KEY (CodMed) REFERENCES Medicamento(CodMed),
	FOREIGN KEY (CodPre) REFERENCES TipoPresentacion(Id)
);

CREATE TABLE Posologia(
	CodDtMed	INT		,
	Dosis		VARCHAR(20)	NOT NULL,
	Indicaciones	VARCHAR(20)	NOT NULL,
	FOREIGN KEY (CodDtMed) REFERENCES dtMED(CodDtMed)
);
CREATE TABLE PrecioActual(
	CodDtMed	INT		REFERENCES dtMED(CodDtMed),
	Precio		DECIMAL(6,2)	NOT NULL,
	Estado		ENUM ('True','False') NOT NULL,
	FecAct		DATE	NOT NULL,
	FOREIGN KEY (CodDtMed) REFERENCES dtMED(CodDtMed)
);
CREATE TABLE	Componentes(
	CodDtMed	INT		,
	Nombre		VARCHAR(20) 	NOT NULL,
	Tipo		VARCHAR(20)	NOT NULL,
	Cantidad	INT		NOT NULL,
	CodUniMedida	INT		,
	FOREIGN KEY (CodUniMedida) REFERENCES UnidadMedida(Id),
	FOREIGN KEY (CodDtMed) REFERENCES dtMED(CodDtMed)
);
CREATE TABLE Almacen(
    Id INT PRIMARY KEY AUTO_INCREMENT,
	CodDtMed	INT		,
	StockActual	SMALLINT	NOT NULL,
	Ubicacion	VARCHAR(20)	NOT NULL,
	FOREIGN KEY (CodDtMed) REFERENCES dtMED(CodDtMed)
);


CREATE TABLE dtGuiaMED(
	NroGuiaRemision  VARCHAR(20) NOT NULL	,
	CodMed	VARCHAR(20),
	IdDt 		INT	PRIMARY KEY	AUTO_INCREMENT,
	Cantidad	VARCHAR(20)	NOT NULL,
	PesoTotal	DECIMAL(6,2),
	Lote		VARCHAR(20)	NOT NULL,
	Descripcion	VARCHAR(20)	NOT NULL,
	FOREIGN KEY (NroGuiaRemision) REFERENCES GuiaRemision(NroGuia),
	FOREIGN KEY (CodMed) REFERENCES Medicamento(CodMed)
);
CREATE TABLE Factura(
	IdDt		INT		,
	CostoUnitario	DECIMAL(6,2),
	CostoTotal	DECIMAL(6,2),
	IGV		DECIMAL(6,2),
	SubTotal	DECIMAL(6,2),
	FOREIGN KEY (IdDt) REFERENCES dtGuiaMED(IdDt)
);


________________________________________________________________

--REGISTRO DE PERSONA 
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Jorge' ,'RAMOS QUISPE','jorgeramos@hotmail.com',to_date('15/08/1979','DD/MM/RR'),'M','Calle Grau 530','Empleado');
INSERT INTO persona (Nombre,Apellido ,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Ivan' ,'ALIAGA VIDAL','ivanaliaga@hotmail.com',to_date('25/03/1980','DD/MM/RR'),'M','AV. LA PAZ 659','Empleado');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Humberto','VELASQUEZ ORTIZ','humbertovalzquez@hotmail.com',to_date('15/06/1979','DD/MM/RR'),'M','AV. BOLIVAR 1789','Empleado');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Luca' ,'RAMOS QUISPE','jorgeramos@hotmail.com',to_date('05/03/1979','DD/MM/RR'),'M','AV. SAENZ PEÑA 52','Empleado');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Antony' ,'RAMOS ORTEGA','jorgeramos@hotmail.com',to_date('13/09/1979','DD/MM/RR'),'M,'PANAMERICANA NORTE KM. 17.5','Empleado');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Julian' ,'QUIJAITE MORENO','julianquijaite@hotmail.com',to_date('15/08/1977','DD/MM/RR'),'M','Calle Libertad 50','Empleado');
INSERT INTO persona (Nombre,Apellido ,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Juliana' ,'CARRILO MARTINEZ','julianacarrilo@hotmail.com',to_date('25/05/1980','DD/MM/RR'),'F','AV. Loreto 69','Empleado');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Luisa','ORTIZ VASQUEZ','luisaortiz@hotmail.com',to_date('15/10/1979','DD/MM/RR'),'F','AV. BOLIVAR 89','Empleado');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Luciana' ,'CACEREZ MUÑANTE','lucianacacerez@hotmail.com',to_date('02/03/1989','DD/MM/RR'),'F','AV. Crusada 503','Empleado');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Ana' ,'LUQUE VERA','analuque@hotmail.com',to_date('23/05/1979','DD/MM/RR'),'F','NORTE KM. 17.5','Empleado');
INSERT INTO persona (Nombre,Apellido ,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Gregoriano' ,'ALVAN PEDREGAL','gregoriaalvan@hotmail.com',to_date('05/03/1990','DD/MM/RR'),'M','AV. Lurin 659','Transportista');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Humberto','QUINTANA CHIWAN','humbertoquintana@hotmail.com',to_date('11/06/1979','DD/MM/RR'),'M','AV. BOLIVAR 19','Transportista');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Javier' ,'MONTES RAMOS','javiermontes@hotmail.com',to_date('25/06/1979','DD/MM/RR'),'M','AV. Sergioa Peña 75','Transportista');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Orlando' ,'RAMOS VERGARA','orlandoramos@hotmail.com',to_date('14/09/1999','DD/MM/RR'),'M,'PANAMERICANA SUR KM. 175','Transportista');
INSERT INTO persona (Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
	      VALUES('Julian' ,'ARIAS PEÑA','julianarias@hotmail.com',to_date('06/08/1977','DD/MM/RR'),'M','Calle Ramirez 50','Transportista');	
	      
_________________________________________________________________
--Creacion de procedimientos almacenados


DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertar_empresa`(
	IN p_ruc char(11) ,
		IN p_razonsocial varchar(40) ,
		IN p_telefono varchar(10) ,
		IN p_direccion varchar(40) ,
		IN p_tipoempresa varchar(13)
)
BEGIN
	INSERT INTO Empresa (ruc,razonsocial,telefono,direccion,tipoempresa)
    values (p_ruc,p_razonsocial,p_telefono,p_direccion,p_tipoempresa);
END ;;
DELIMITER ;


/*  INSERTAR PERSONA  */
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_persona(
  IN p_dni		    CHAR(8),
	IN p_nombre 		VARCHAR(25),
	IN p_apellido 	VARCHAR(20),
	IN p_fecnac 		DATE,
	IN p_genero 		varchar(1),
	IN p_direccion	VARCHAR(40),
	IN p_tipo_persona	varchar(20),
   IN p_correo 	VARCHAR(50)
)
BEGIN
	INSERT INTO Persona(dni,nombre,apellido,fecnac,genero,direccion,tipoPersona,correo)
    VALUES (p_dni,p_nombre,p_apellido,p_fecnac,p_genero,p_direccion,p_tipo_persona,p_correo);
END ;;
DELIMITER ;


DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertar_tipopresentacion`(
	in p_nombre varchar(20),
    in p_descripcion varchar(30)
)
BEGIN
	INSERT INTO TipoPresentacion(Nombre,Descripcion) VALUES(p_nombre,p_descripcion);
END ;;
DELIMITER ;


DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `insertar_unidadmedida`(
	IN p_descripcion varchar(10)
)
BEGIN
	INSERT INTO UnidadMedida(descripcion) values(p_descripcion);
END ;;
DELIMITER ;

/*  INSERTAR MEDICAMENTO  */
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_medicamento(
	IN p_cod_med varchar(20),
    IN p_nombre varchar(20),
    IN p_nom_laboratorio varchar(20),
    IN p_id_laboratorio int
)
BEGIN
	INSERT INTO Medicamento (codmed,nombre,nomlaboratorio,idlaboratorio)
    VALUES(p_cod_med,p_nombre,p_nom_laboratorio,p_id_laboratorio);
END ;;
DELIMITER ;


/*  INSERTAR GUIA REMISION  */
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_guia_remision(
	IN p_nro_guia 	VARCHAR(20),
    IN p_punto_partida 	VARCHAR(20),
	IN p_punto_llegada	VARCHAR(20),
	IN p_fec_emision 	DATE,
	IN p_fec_inic_traslado DATE,
	IN p_motiv_traslado	VARCHAR(20),
	IN p_id_transporte	INT
)
BEGIN
	INSERT INTO GuiaRemision(nroguia,PuntoPartida,PuntoLLegada,FecEmision,FecInicTraslado,MotTraslado,IdTransporte)
	 values(p_nro_guia,p_punto_partida,p_punto_llegada,p_fec_emision,p_fec_inic_traslado,p_motiv_traslado,p_id_transporte);
END ;;
DELIMITER ;


/* ELIMINAR EMPLEADO */

DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `up_eliminar_empleado`(
	IN pDNI VARCHAR(20)
)
BEGIN
	DELETE FROM empleado WHERE DNI = pDNI;
END ;;
DELIMITER ;

/* ELIMINAR EMPRESA*/
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `up_eliminar_empresa`(
	IN pRUC VARCHAR(20)
)
BEGIN
	DELETE FROM empresa WHERE RUC = pRUC;
END ;;
DELIMITER ;

/* ELIMINAR TRANSPORTE */

DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `up_eliminar_transporte`(
	IN pRUC VARCHAR(20)
)
BEGIN
	DELETE FROM transporte WHERE RUC = pRUC;
END ;;
DELIMITER ;
---------------------------------------------
DELIMITER ;;
/*  INSERTAR ALMACEN  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_almacen(
	IN p_CodDtMed int(11),
	IN	p_StockActual SMALLINT,
	IN	p_Ubicacion varchar(20)
)
BEGIN
	INSERT INTO almacen(CodDtMed,StockActual,Ubicacion)
        VALUES (p_CodDtMed,p_StockActual,p_Ubicacion);
END ;;
DELIMITER ;

DELIMITER ;;
/*  INSERTAR COMPONENTES  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_componentes(
  IN p_CodDtMed		    int(11),
	IN p_Nombre 	varchar(20),
	IN p_Tipo 	varchar(20),
	IN p_Cantidad int(11),
	IN p_CodUniMedida int(11)
)
BEGIN
	INSERT INTO Componentes(CodDtMed,Nombre,Tipo,Cantidad,CodUniMedida)
    VALUES (p_CodDtMed,p_Nombre,p_Tipo,p_Cantidad,p_CodUniMedida);
END ;;
DELIMITER ;

DELIMITER ;;
/*  INSERTAR DETALLEGUIAMEDICAMENTO  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_dtguiamed(
  IN p_NroGuiaRemision varchar(20),
  IN p_CodMed varchar(20),
  IN p_IdDt int(11),
  IN p_Cantidad varchar(20),
  IN p_PesoTotal decimal(6,2),
  IN p_Lote varchar(20),
  IN p_Descripcion varchar(20)
)
BEGIN
	INSERT INTO dtguiamed(NroGuiaRemision,CodMed,IdDt,Cantidad,PesoTotal,Lote,Descripcion)
    VALUES (p_NroGuiaRemision,p_CodMed,p_IdDt,p_Cantidad,p_PesoTotal,p_Lote,p_Descripcion);
END ;;
DELIMITER ;

DELIMITER ;;
/*  INSERTAR DETALLEMEDICALEMNTO  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_dtmed(
  IN CodMed varchar(20),
  IN CodPre int(11),
  IN CodDtMed int(11),
  IN Psicotrópico enum('Si','No'),
  IN PesoUnitario decimal(6,2),
  IN FecVenc date ,
  IN Descripcion varchar(20)
)
BEGIN
	INSERT INTO dtmed(CodMed,CodPre,CodDtMed,Psicotrópico,PesoUnitario,FecVenc,Descripcion)
    VALUES (p_CodMed,p_CodPre,P_CodDtMed,p_Psicotrópico,p_PesoUnitario,p_FecVenc,p_Descripcion);
END ;;
DELIMITER ;


DELIMITER ;;
/*  INSERTAR TRANSPORTE  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_transporte(
	IN	p_RUC varchar(20),
	IN  p_IdTransporte int(11),
    IN  p_Placa varchar(20)
)
BEGIN
	INSERT INTO transporte(RUC,IdTransporte,Placa)
    VALUES (p_RUC,p_IdTransporte,p_Placa);
END ;;
DELIMITER ;

DELIMITER ;;
/*  INSERTAR FACTURA  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_factura(
  IN p_IdDt int(11),
  IN p_CostoUnitario decimal(6,2),
  IN p_CostoTotal decimal(6,2),
  IN p_IGV decimal(6,2),
  IN p_SubTotal decimal(6,2)
  )
BEGIN
	INSERT INTO factura(IdDt,CostoUnitario,CostoTotal,IGV,SubTotal)
    VALUES (p_IdDt,p_CostoUnitario,p_CostoTotal,p_IGV,p_SubTotal);
END ;;
DELIMITER ;

DELIMITER ;;
/*  INSERTAR LABORATORIO  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_laboratorio(
  IN p_RUC varchar(20),
  IN p_IdLaboratorio int(11),
  IN p_RegSanitario varchar(20)
  )
BEGIN
	INSERT INTO laboratorio(RUC,IdLaboratorio,RegSanitario)
    VALUES (p_RUC,p_IdLaboratorio,p_RegSanitario);
END ;;
DELIMITER ;


DELIMITER ;;
/*  INSERTAR POSOLOGIA  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_posologia(
  IN CodDtMed int(11),
  IN Dosis varchar(20),
  IN Indicaciones varchar(20)
  )
BEGIN
	INSERT INTO posologia(CodDtMed,Dosis,Indicaciones)
    VALUES (p_CodDtMed,p_Dosis,p_Indicaciones);
END ;;
DELIMITER ;


DELIMITER ;;
/*  INSERTAR PRECIOACTUAL  */
CREATE DEFINER=`root`@`localhost` PROCEDURE up_insertar_precioactual(
  IN CodDtMed int(11),
  IN Precio decimal(6,2),
  IN Estado enum('True','False'),
  IN FecAct date
  )
BEGIN
	INSERT INTO precioactual(CodDtMed,Precio,Estado,FecAct)
    VALUES (p_CodDtMed,p_Precio,p_Estado,p_FecAct);
END ;;
DELIMITER ;

===============================================

DELIMITER //
CREATE PROCEDURE insertar_persona_empleado(IN p_DNI		CHAR(8),
IN p_nombre 		VARCHAR(25),
IN p_apellido 	VARCHAR(20),
IN p_correo		VARCHAR(20),
IN p_fecNac 		DATE,
IN p_genero 		ENUM ('M','F'),
IN p_direccion	VARCHAR(20),
IN p_tipoPersona	ENUM ('Empleado','Transportista'),
IN e_turno		VARCHAR(20),
IN e_especialidad	VARCHAR(20),
IN e_usuario		VARCHAR(20),
IN e_clave		VARCHAR(20),
IN e_DNI		VARCHAR(20))

BEGIN
 INSERT INTO PERSONA(DNI,Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona)
 VALUES (p_DNI,p_nombre,p_apellido,p_correo,p_fecNac,p_genero,p_direccion,p_tipoPersona);

 INSERT INTO EMPLEADO (turno,especialidad,usuario,clave,DNI)
 VALUES (e_turno,e_especialidad,e_usuario,e_clave,e_DNI);

END;
//
=====================================================
DELIMITER //
CREATE PROCEDURE insertar_persona_transportista(
IN p_DNI		CHAR(8),
IN p_nombre 		VARCHAR(25),
IN p_apellido 	VARCHAR(20),
IN p_correo		VARCHAR(20),
IN p_fecNac 		DATE,
IN p_genero 		ENUM ('M','F'),
IN p_direccion	VARCHAR(20),
IN p_tipoPersona	ENUM ('Empleado','Transportista'),

IN t_DNI 		VARCHAR(8),
IN t_IdTransporte	INT,
IN t_NroLicencia	VARCHAR(15))

BEGIN
 INSERT INTO PERSONA(DNI,Nombre,Apellido,Correo,FecNac,Genero,Direccion,TipoPersona) VALUES (p_DNI,p_nombre,p_apellido,p_correo,p_fecNac,p_genero,p_direccion,p_tipoPersona);
 INSERT INTO TRANSPORTISTA (DNI,IdTransporte,NroLicencia) VALUES (t_DNI,t_IdTransporte,t_NroLicencia);
END;
//



===========================================================
DELIMITER //
CREATE PROCEDURE insertar_empresa_transporte(
IN e_RUC 		VARCHAR(20),
IN e_RazónSocial 	VARCHAR(40),
IN e_Telefono 	VARCHAR(10),
IN e_Dirección 	VARCHAR(20),
IN e_TipoEmpresa	VARCHAR(30))

IN t_RUC 		VARCHAR(20),
IN t_Placa 		VARCHAR(20),

BEGIN
	INSERT INTO EMPRESA values (e_RUC,e_RazonSocial,e_Telefono,e_Direccion,e_TipoEmpresa);

	INSERT INTO TRANSPORTE values (t_RUC,t_Placa);

END;
//

===================================
DELIMITER //
CREATE PROCEDURE insertar_empresa_laboratorio(IN e_RUC 		VARCHAR(20),IN e_RazónSocial 	VARCHAR(40),IN e_Telefono 	VARCHAR(10),IN e_Dirección 	VARCHAR(20),IN e_TipoEmpresa	VARCHAR(30),IN l_RUC		VARCHAR(20),IN l_RegSanitario	VARCHAR(20))

BEGIN
  INSERT INTO EMPRESA values (e_RUC,e_RazonSocial,e_Telefono,e_Direccion,e_TipoEmpresa);

  INSERT INTO LABORATORIO  values (l_RUC,l_RegSanitario);
END;
//




/***LISTAR ALMACEN**/

DELIMITER $$
USE `farmacia`$$
CREATE PROCEDURE `up_listar_almacen`
(
	IN p_coddtmed int
)
BEGIN
	select * from almacen where CodDtMed like concat(p_coddtmed,'%');
END$$

DELIMITER ;


/**** LISTAR EMPLEADO ****/
DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_listar_empleado`(
	IN p_dni CHAR(8)
)
BEGIN

    select * from empleado where dni
    like concat(p_dni,'%');

END$$

DELIMITER ;


/***** LISTAR PERSONA ***/
DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_listar_persona`(
	IN p_dni char(8)
)
BEGIN
	select * from persona where dni
    like CONCAT(p_dni,'%');
END$$

DELIMITER ;

/***** ACTUALIZAR UNIDAD DE MEDIDA ****/
DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_actualizar_unidad_medida`(
	IN p_id int,
    IN p_descripcion varchar(10)
)
BEGIN
	UPDATE UnidadMedida
    SET descripcion=p_descripcion WHERE id=p_id;
END$$

DELIMITER ;


/***** ACTUALIZAR TIPO DE PRESENTACION  ****/

DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_actualizar_tipo_presentacion`(
	IN p_id		INT,
	IN p_nombre		VARCHAR(20),
	IN p_descripcion	VARCHAR(30)
)
BEGIN
	UPDATE TipoPresentacion
    SET nombre=p_nombre,descripcion=p_descripcion WHERE id=p_id;
END$$

DELIMITER ;


/***** ACTUALIZAR PERSONA  ****/


DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_actualizar_persona`(
	IN p_dni		    CHAR(8),
	IN p_nombre 		VARCHAR(25),
	IN p_apellido 	VARCHAR(20),
	IN p_fecnac 		DATE,
	IN p_genero 		varchar(1),
	IN p_direccion	VARCHAR(40),
	IN p_tipo_persona	varchar(20),
    IN p_correo 	VARCHAR(50)
)
BEGIN
	UPDATE Persona SET nombre=p_nombre, apellido=p_apellido, fecnac=p_fecnac, genero=p_genero,
			direccion=p_direccion, tipoPersona=p_tipo_persona, correo=p_correo where dni=p_dni;
END$$

DELIMITER ;


/***** ACTUALIZAR EMPLEADO  ****/


DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_actualizar_empleado`(
	in p_id int,
    IN p_turno VARCHAR(20),
    IN p_especialidad VARCHAR(40),
    IN p_usuario VARCHAR(20),
    IN p_clave VARCHAR(20),
    IN p_dni CHAR(8)
)
BEGIN
	UPDATE Empleado SET turno=p_turno, especialidad=p_especialidad,
		usuario=p_usuario, clave=p_clave,dni=p_dni WHERE IdEmpleado=p_id;
END$$

DELIMITER ;


/***** ELIMINAR UNIDAD DE MEDIDA **********/

DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_eliminar_unidad_medida`(
	IN p_id int
)
BEGIN
	DELETE FROM UnidadMedida
    WHERE id=p_id;
END$$

DELIMITER ;


/***** ELIMINAR TIPO DE PRESENTACION **********/

DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_eliminar_tipo_presentacion`(
	IN p_id int
)
BEGIN
	DELETE FROM TipoPresentacion
    WHERE id=p_id;
END$$

DELIMITER ;


/***** ELIMINAR PERSONA **********/



DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_eliminar_persona`(
	IN p_dni char(8)
)
BEGIN
	DELETE FROM Persona
    WHERE dni=p_dni;
END$$

DELIMITER ;


/***    ELIMINAR ALMACEN        ***/

DELIMITER $$
USE `farmacia`$$
CREATE PROCEDURE `up_eliminar_almacen`
(
	in p_id int
)
BEGIN
	delete from almacen where id = p_id;
END$$

DELIMITER ;

/***    ACTUALIZAR ALMACEN        ***/
DELIMITER $$
USE `farmacia`$$
CREATE PROCEDURE `up_actualizar_almacen`
(
	in p_id int,
    IN p_CodDtMed int(11),
	IN	p_StockActual smallint,
	IN	p_Ubicacion varchar(20)
)
BEGIN
	update almacen set CodDtMed=p_CodDtMed, StockActual= p_StockActual, Ubicacion = p_Ubicacion
        WHERE id=p_id;
END$$

DELIMITER ;



/**** LISTAR UNIDAD DE MEDIDAD ****/
DELIMITER $$
USE `farmacia`$$
CREATE PROCEDURE `up_listar_unidad_medida`
(
	IN p_descripcion varchar(10)
)
BEGIN
	select * from UnidadMedida where descripcion like concat(p_descripcion,'%');
END$$

DELIMITER ;


/***** ACTUALIZAR GUIA REMISION ***********/

DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_actualizar_guiaremision`(
	IN p_nroguia		    varchar(20),
	IN p_puntopartida 		VARCHAR(20),
	IN p_puntollegada 		VARCHAR(20),
	IN p_fecemision 			DATE,
	IN p_fecinictraslado 		DATE,
	IN p_mottraslado		VARCHAR(20),
	IN p_idtransporte	varchar(20)
)
BEGIN
	UPDATE guiaremision SET NroGuia=p_nroguia, PuntoPartida=p_puntopartida, PuntoLLegada=p_puntollegada,
			FecEmision=p_fecemision, FecInicTraslado=p_fecinictraslado, MotTraslado=p_mottraslado,
			IdTransporte=p_idtransporte where NroGuia=p_nroguia;
END$$
DELIMITER ;



/***** ELIMINAR GUIA REMISION ***********/

DELIMITER $$
use `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_eliminar_guiaremision`(
	IN p_nroguia varchar(20)
)
BEGIN
	DELETE FROM guiaremision WHERE NroGuia=p_nroguia;
END$$
DELIMITER ;



/***** LISTAR GUIA REMISION ***********/

DELIMITER $$
use `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_listar_guiaremision`(
	IN p_nroguia char(20)
)
BEGIN
	select * from guiaremision where NroGuia like CONCAT(p_nroguia,'%');
END$$
DELIMITER ;


/***** ELIMINAR MEDICAMENTO ***********/

DELIMITER $$
use `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_eliminar_medicamento`(
	IN p_codmed varchar(20)
)
BEGIN
	DELETE FROM medicamento WHERE CodMed=p_codmed;
END$$
DELIMITER ;


/***** ACTUALIZAR EMPRESA ***********/

DELIMITER $$
use `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_actualizar_empresa`(
		IN p_RUC varchar(20),
    IN p_RazonSocial VARCHAR(40),
    IN p_Telefono VARCHAR(10),
    IN p_Direccion VARCHAR(20),
    IN p_TipoEmpresa VARCHAR(20)
)
BEGIN
	UPDATE empresa SET RUC=p_RUC, RazónSocial=p_RazonSocial,
		   Telefono=p_Telefono, Direccion=p_Direccion,TipoEmpresa=p_TipoEmpresa WHERE RUC=p_RUC;
END$$
DELIMITER ;

/***** ELIMINAR POSOLOGIA ***********/


DELIMITER $$
use `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_eliminar_posologia`(
	IN p_codDtMed VARCHAR(20)
)
BEGIN
	DELETE FROM posologia WHERE CodDtMed = p_codDtMed;
END$$
DELIMITER ;

/***** ACTUALIZAR POSOLOGIA ***********/

DELIMITER $$
use `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_actualizar_posologia`(

	  IN p_codDtMed int(11),
    IN p_Dosis VARCHAR(20),
    IN p_Indicaciones VARCHAR(20)

)
BEGIN
	UPDATE posologia SET  CodDtMed=p_codDtMed, Dosis=p_Dosis,
			Indicaciones=p_Indicaciones WHERE CodDtMed=p_codDtMed;
END$$
DELIMITER ;

/***** ACTUALIZAR MEDICAMENTO ***********/


DELIMITER $$
USE `farmacia`$$
CREATE DEFINER=`meister`@`%` PROCEDURE `up_actualizar_medicamento`(
	IN p_codmed		    varchar(20),
	IN p_Nombre 		VARCHAR(20),
	IN p_NomLaboratorio 		VARCHAR(20),
	IN p_IdLaboratorio 			int(11)
)
BEGIN
			UPDATE medicamento SET CodMed=p_codmed, Nombre=p_Nombre, NomLaboratorio=p_NomLaboratorio,
			IdLaboratorio=p_IdLaboratorio
			where CodMed=p_codmed;
END$$
DELIMITER ;


====================================================================================
/************** FUNCIONES *****************/
======================================================================================

DELIMITER ;;
CREATE DEFINER=meister@`%` FUNCTION verificar_usuario_clave(p_usuario varchar(20), p_contraseña varchar(20)) RETURNS tinyint(1)
    READS SQL DATA
BEGIN
	RETURN EXISTS (SELECT dni FROM empleado WHERE usuario = p_usuario AND clave = p_contraseña);
END ;;
DELIMITER ;
